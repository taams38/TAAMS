<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TAAMS | Autonomous Protocol</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;700&family=Syncopate:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <style>
        :root {
            --bg-color: #030303;
            --panel-bg: rgba(10, 10, 10, 0.85);
            --border: rgba(255, 255, 255, 0.08);
            --accent: #00ff88; 
            --accent-glow: rgba(0, 255, 136, 0.15);
            --secondary: #ff00ff;
            --text-main: #ffffff;
            --text-dim: #666666;
            --font-head: 'Syncopate', sans-serif;
            --font-body: 'Space Grotesk', sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; cursor: none; }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: var(--font-body);
            overflow: hidden;
            height: 100vh;
            display: flex;
        }

        /* --- WebGL Background --- */
        #canvas-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1; opacity: 0.6; pointer-events: none;
        }

        /* --- Custom Cursor --- */
        .cursor {
            position: fixed; width: 6px; height: 6px; background: var(--accent);
            border-radius: 50%; pointer-events: none; z-index: 9999;
            transform: translate(-50%, -50%); transition: width 0.2s, height 0.2s;
            mix-blend-mode: exclusion;
        }
        .cursor.hovered { width: 60px; height: 60px; background: transparent; border: 1px solid var(--accent); opacity: 0.8; }

        /* --- Sidebar --- */
        aside {
            width: 300px; border-right:1px solid var(--border);
            padding: 2rem; display: flex; flex-direction: column;
            z-index: 10; background: var(--bg-color);
        }

        .brand {
            font-family: var(--font-head); font-size: 1.6rem; font-weight: 700;
            color: var(--text-main); margin-bottom: 3rem; letter-spacing: -1px;
            text-transform: uppercase;
        }
        .brand span { color: var(--accent); }

        nav button {
            background: transparent; border: none; color: var(--text-dim);
            font-family: var(--font-body); font-size: 0.9rem;
            text-align: left; padding: 1rem 0; width: 100%;
            transition: all 0.3s; text-transform: uppercase; letter-spacing: 1px;
            border-left: 2px solid transparent;
        }
        nav button:hover { color: #fff; padding-left: 1rem; }
        nav button.active { color: var(--accent); border-left: 2px solid var(--accent); background: linear-gradient(90deg, rgba(0,255,136,0.05), transparent); }

        /* --- Main Content --- */
        main {
            flex: 1; padding: 3rem; overflow-y: auto; position: relative; z-index: 10;
            display: flex; flex-direction: column;
        }

        .section { display: none; animation: fadeIn 0.5s ease; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- Components --- */
        .card {
            background: var(--panel-bg); border: 1px solid var(--border);
            padding: 2rem; border-radius: 4px; margin-bottom: 2rem;
            backdrop-filter: blur(15px); transition: transform 0.2s;
            position: relative; overflow: hidden;
        }
        .card:hover { border-color: rgba(255,255,255,0.2); }
        
        .card-header { font-family: var(--font-head); font-size: 1.2rem; margin-bottom: 1.5rem; border-bottom: 1px solid var(--border); padding-bottom: 0.5rem; display: flex; justify-content: space-between;}

        /* --- Vitality Meter --- */
        .vitality-container {
            text-align: center; padding: 3rem 1rem;
            background: linear-gradient(180deg, rgba(0,255,136,0.05) 0%, transparent 100%);
            border: 1px solid var(--accent); margin-bottom: 3rem;
        }
        .vitality-title { font-family: var(--font-head); font-size: 2rem; margin-bottom: 1rem; color: #fff; }
        .progress-track { width: 100%; height: 8px; background: #222; border-radius: 4px; overflow: hidden; margin: 1rem auto; max-width: 600px; }
        .progress-fill { height: 100%; background: var(--accent); width: 0%; transition: width 1s ease; box-shadow: 0 0 20px var(--accent); }
        .vitality-stats { display: flex; justify-content: center; gap: 2rem; margin-top: 1.5rem; font-size: 1.2rem; color: var(--text-dim); }
        .vitality-stat span { color: #fff; font-weight: bold; }

        /* --- Stats Grid --- */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; }
        .stat-item { background: rgba(255,255,255,0.03); padding: 1.5rem; border: 1px solid var(--border); }
        .stat-val { font-family: var(--font-head); font-size: 1.8rem; color: #fff; margin-bottom: 0.5rem; }
        .stat-label { color: var(--text-dim); font-size: 0.8rem; text-transform: uppercase; }

        /* --- Forms --- */
        input, select, textarea {
            width: 100%; background: rgba(0,0,0,0.5); border: 1px solid var(--border);
            color: #fff; padding: 1rem; font-family: var(--font-body);
            margin-bottom: 1rem; border-radius: 2px; font-size: 1rem;
        }
        input:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 10px var(--accent-glow); }

        .btn {
            background: var(--accent); color: #000; border: none; padding: 1rem 2rem;
            font-weight: 700; text-transform: uppercase; cursor: pointer;
            border-radius: 2px; transition: all 0.2s; font-family: var(--font-head);
            font-size: 0.9rem; display: inline-block; margin-right: 0.5rem;
            position: relative; overflow: hidden;
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 20px var(--accent-glow); letter-spacing: 1px; }
        .btn:disabled { opacity: 0.3; cursor: not-allowed; transform: none; background: #333; color: #888; }
        .btn.secondary { background: transparent; border: 1px solid #fff; color: #fff; }
        .btn.secondary:hover { background: #fff; color: #000; }
        .btn.danger { background: var(--secondary); color: #fff; }

        /* --- Notifications --- */
        #toast-container { position: fixed; bottom: 2rem; right: 2rem; z-index: 100; display: flex; flex-direction: column; gap: 0.5rem; pointer-events: none; }
        .toast { background: #111; color: #fff; padding: 1rem; border-left: 4px solid var(--accent); box-shadow: 0 5px 20px rgba(0,0,0,0.5); animation: slideIn 0.3s; pointer-events: auto; min-width: 300px; }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        /* --- Vote Styles --- */
        .vote-step { border-left: 3px solid var(--border); padding-left: 1.5rem; margin-bottom: 2rem; position: relative; }
        .vote-step::before { content:''; position: absolute; left: -9px; top: 0; width: 15px; height: 15px; background: var(--bg-color); border: 2px solid var(--text-dim); border-radius: 50%; }
        .vote-step.active::before { border-color: var(--accent); background: var(--accent); box-shadow: 0 0 10px var(--accent); }
        .step-title { font-weight: bold; color: var(--accent); text-transform: uppercase; font-size: 0.8rem; margin-bottom: 0.5rem; display: block; }

        /* --- Ads Styles --- */
        .news-list { display: flex; flex-direction: column; gap: 1.5rem; }
        .news-item {
            background: rgba(255,255,255,0.03); border: 1px solid var(--border); padding: 1rem; border-left: 4px solid var(--accent);
            display: flex; justify-content: space-between; align-items: center;
        }
        .news-date { font-size: 0.8rem; color: var(--accent); margin-bottom: 0.5rem; }
        .news-msg { font-family: var(--font-head); font-size: 1.1rem; color: #fff; }

        /* --- Whitepaper Styles --- */
        #whitepaper-content { display: none; /* Hidden by default */
        
        .wp-container {
            max-width: 800px;
            margin: 0 auto;
            background: #0808080; 
            padding: 40px;
            border: 1px solid #333;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }

        .wp-title { font-family: var(--font-head); font-size: 2rem; color: #fff; margin-bottom: 2rem; }
        .wp-section { margin-bottom: 2rem; }
        
        .wp-h2 { color: var(--accent); border-bottom: 1px solid #333; padding-bottom: 1rem; font-size: 1.5rem; text-transform: uppercase; font-family: var(--font-head); }

        .wp-p { margin-bottom: 1rem; text-align: justify; line-height: 1.6rem; color: #ccc; }
        .wp-strong { color: var(--accent); }
        .wp-err { color: var(--secondary); }
        .wp-code {
            background: #000; border: 1px solid #444;
            padding: 1rem;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            color: #00ff88;
            margin-bottom: 2rem;
            border-radius: 4px;
        }
        .wp-table { width: 100%; border-collapse: collapse; margin-bottom: 2rem; }
        .wp-table th, .wp-table td {
            border: 1px solid #444; padding: 10px; text-align: left;
        }
        .wp-table th { background-color: #111; color: #fff; font-weight: bold; }
        .wp-table tr:nth-child(even) { background-color: #0a0a0a0; }

        .security-box {
            border-left: 4px solid var(--accent); 
            background: rgba(0,255,136,0.05);
            padding: 20px;
            margin: 20px 0;
        }
        .security-box p { margin-bottom: 15px; }

        /* --- Utility --- */
        .text-dim { color: var(--text-dim); font-size: 0.9rem; margin-bottom: 1rem; display: block; line-height: 1.5rem; }
        .highlight { color: var(--accent); }
        .full-width { width: 100%; }
        .no-print { display: none; }
        
        /* Footer */
        .protocol-footer { margin-top: auto; padding-top: 2rem; border-top: 1px solid var(--border); text-align: center; color: #444; font-size: 0.8rem; }
    </style>
</head>
<body>

    <div class="cursor" id="cursor"></div>
    <div id="toast-container"></div>
    <div id="canvas-container"></div>

    <!-- Sidebar -->
    <aside>
        <div class="brand">TAAMS <span>PROTOCOL</span></div>
        
        <nav>
            <div class="nav-section-title">Actions</div>
            <button class="active" onclick="switchTab('dashboard')">Vitality & Ignition</button>
            <button onclick="switchTab('wallet')">Wallet</button>
            <button onclick="switchTab('burn')">Burn & BL2P</button>
            <button onclick="switchTab('staking')">Staking</button>
            <button onclick="switchTab('governance')">DAO & Governance</button>
            <button onclick="switchTab('ads')">Publicité (Ads)</button>
            <button onclick="switchTab('wallet-palette')">Wallet & Palette</button>
            <button onclick="switchTab('whitepaper')">Livre Blanc (PDF)</button>
        </nav>

        <div style="margin-top: auto;">
            <!-- Network Status Indicator -->
            <div id="network-display" style="margin-bottom: 1rem; text-align: center; font-size: 0.8rem;">
                Checking Network...
            </div>
            
            <div id="wallet-status" class="text-dim" style="text-align:center; margin-bottom:1rem;">Disconnected</div>
            <button id="connect-btn" class="btn full-width" style="width:100%" onclick="connectWallet()">CONNECT</button>
        </div>
    </aside>

    <!-- Main Content -->
    <main>

        <!-- DASHBOARD / VITALITY -->
        <section id="dashboard" class="section active">
            
            <!-- The Heart of Protocol -->
            <div class="vitality-container">
                <div class="vitality-title">PROTOCOL VITALITY</div>
                <p class="text-dim">The system depends entirely on community participation.</p>
                
                <div class="progress-track">
                    <div id="vitality-bar" class="progress-fill"></div>
                </div>
                
                <div class="vitality-stats">
                    <div class="vitality-stat"><span id="ign-count">0</span> / 1000</div>
                    <div class="vitality-stat">Founders</div>
                </div>

                <div id="ignition-message" style="margin-top: 2rem; font-family: var(--font-head);">
                    <!-- Dynamic Message -->
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-val" id="dash-balance">0</div>
                    <div class="stat-label">Your TAAMS</div>
                </div>
                <div class="stat-item">
                    <div class="stat-val" id="dash-bl2p">0</div>
                    <div class="stat-label">Governance Power</div>
                </div>
                <div class="stat-item">
                    <div class="stat-val" id="dash-burned">0</div>
                    <div class="stat-label">Total Burned</div>
                </div>
                <div class="stat-item">
                    <div class="stat-val" id="total-staked-protocol">0</div>
                    <div class="stat-label">Total Staked (Global)</div>
                </div>
            </section>

            <div class="card">
                <div class="card-header">System Status</div>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:1rem;">
                    <div>
                        <span class="text-dim">Burn Phase:</span>
                        <div id="status-burn" style="color: #fff;">Checking...</div>
                    </div>
                    <div>
                        <span class="text-dim">Ignition Triggered:</span>
                        <div id="status-ignition" style="color: #fff;">Checking...</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- WALLET -->
        <section id="wallet" class="section">
            <h2 style="font-family:var(--font-head); margin-bottom:2rem;">Wallet Management</h2>
            
            <div class="card">
                <div class="card-header">Permissions (Approvals)</div>
                <span class="text-dim">Authorize protocol to manage your assets for Staking or Operations.</span>
                <div style="display:flex; gap:1rem;">
                    <input type="number" id="approve-amount" placeholder="TAAMS Amount">
                    <button class="btn" onclick="handleApprove()">APPROVE</button>
                </div>
                <div id="allowance-info" class="text-dim" style="font-size:0.8rem;">Current Allowance: Loading...</div>
            </div>

            <div class="card">
                <div class="card-header">Transfer</div>
                <span class="text-dim">Send TAAMS to another wallet address.</span>
                <input type="text" id="transfer-to" placeholder="Recipient Address (0x...)">
                <input type="number" id="transfer-amount" placeholder="Amount">
                <button class="btn" onclick="handleTransfer()">TRANSFER</button>
            </div>
        </section>

        <!-- BURN & BL2P -->
        <section id="burn" class="section">
            <h2 style="font-family:var(--font-head); margin-bottom:2rem;">Deflation & Governance</h2>

            <div class="card">
                <div class="card-header">Incinerate Tokens (Burn)</div>
                <span class="text-dim">Burning TAAMS permanently reduces supply and grants you BL2P (Governance Power). <br>The protocol lives through deflation.</span>
                
                <div style="margin: 1rem 0; padding:1rem; background:rgba(255,255,255,0.05);">
                    <span class="text-dim">Remaining in Cycle:</span> <span id="burn-remaining" class="highlight">Loading...</span>
                </div>

                <div style="display:flex; gap:1rem;">
                    <input type="number" id="burn-amount" placeholder="Amount to Burn">
                    <button class="btn" id="btn-burn" onclick="handleBurn()">BURN</button>
                </div>
                <button class="btn secondary" onclick="setInputMax('burn-amount')">SET MAX</button>
            </div>

            <div class="card">
                <div class="card-header">Claim Governance Rights (BL2P)</div>
                <span class="text-dim">Claim your voting power. This is non-transferable until maturity.</span>
                <button class="btn" id="btn-claim-bl2p" onclick="handleClaimBL2P()">CLAIM BL2P</button>
            </div>
        </section>

        <!-- STAKING -->
        <section id="staking" class="section">
            <h2 style="font-family:var(--font-head); margin-bottom:2rem;">Yield & Staking</h2>

            <div class="card">
                <div class="card-header">Protocol Staking Stats</div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-val" id="total-staked-display">0</div>
                        <div class="stat-label">Total Staked (Global)</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-val" style="font-size:1.2rem; color:var(--accent);">1,000 TAAMS</div>
                        <div class="stat-label">Minimum Required</div>
                    </div>
                </div>

            <div class="card">
                <div class="card-header">My Stake</div>
                
                <div id="user-stake-details" style="margin-bottom: 2rem; display:none; border: 1px solid var(--border); padding:1rem; border-radius:4px;">
                    <p style="color:#fff;"><strong>Amount:</strong> <span id="my-stake-amount" class="highlight">0</span> TAAMS</p>
                    <p style="color:#fff;"><strong>Boost (BL2P):</strong> <span id="my-stake-boost">0</span></p>
                    <p style="color:#fff;"><strong>Locked Since:</strong> <span id="my-stake-date">-</span></p>
                    <button class="btn danger" onclick="handleUnstake()">UNSTAKE ALL</button>
                </div>

                <div id="no-stake-msg" class="text-dim">You are not staking yet.</div>
            </div>

            <div class="card">
                <div class="card-header">Actions</div>
                <span class="text-dim">First Approve, then Stake. Minimum is 1000 TAAMS.</span>

                <div style="margin-bottom: 1rem;">
                    <input type="number" id="stake-amount" placeholder="Min: 1000 TAAMS">
                </div>

                <div style="margin-bottom: 1rem;">
                    <button class="btn secondary" onclick="setInputMax('stake-amount')">SET MAX</button>
                    <button class="btn" id="btn-approve-stake" onclick="handleApproveStake()">1. APPROVE STAKING</button>
                    <button class="btn" id="btn-stake-action" onclick="handleStake()">2. STAKE</button>
                </div>

                <div style="border-top: 1px solid var(--border); padding-top: 1rem; margin-top: 1rem;">
                    <span class="text-dim" style="color:var(--accent)">BOOST YIELD (Optional)</span>
                    <p style="font-size:0.8rem; color:#888; margin-bottom:0.5rem;">Use your BL2P (Governance Power) to increase your TAAMS yield.</p>
                    <div style="display: flex; gap: 1rem;">
                        <input type="number" id="boost-amount" placeholder="BL2P Amount">
                        <button class="btn secondary" onclick="handleBoost()">BOOST</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- GOVERNANCE -->
        <section id="governance" class="section">
            <h2 style="font-family:var(--font-head); margin-bottom:2rem;">Community Control</h2>

            <div class="card">
                <div class="card-header">Create Proposal</div>
                <span class="text-dim">Shape future of protocol. Requires Voting Power.</span>
                
                <select id="proposal-type">
                    <option value="0">Change Annual Burn Amount</option>
                    <option value="1">Change Staking Reward Rate</option>
                    <option value="2">Emergency Pause Protocol</option>
                    <option value="3">Unlock Reserve (Treasury)</option>
                    <option value="4">Post Advertisement (News)</option>
                    <option value="5">Adjust BL2P Maturation Time</option>
                    <option value="6">Change Quorum</option>
                </select>
                <input type="text" id="proposal-desc" placeholder="Proposal Description / News Message">
                <input type="number" id="proposal-value" placeholder="New Value (if applicable)">
                <input type="text" id="proposal-address" placeholder="New Address (if applicable)">
                <button class="btn" onclick="handleSubmitProposal()">SUBMIT PROPOSAL</button>
            </div>

            <div class="card">
                <div class="card-header">Vote (Commit & Reveal)</div>
                <span class="text-dim">Voting is anonymous and split into two phases to prevent corruption.</span>
                
                <!-- Step 1 -->
                <div class="vote-step">
                    <span class="step-title">Step 1: Load Proposal</span>
                    <div style="display:flex; gap:1rem;">
                        <input type="number" id="vote-proposal-id" placeholder="Proposal ID">
                        <button class="btn secondary" style="margin:0" onclick="loadProposal()">LOAD</button>
                    </div>
                    <div id="proposal-data" style="margin-top:1rem; display:none; background:rgba(0,0,0,0.3); padding:1rem;">
                        <p><strong>Desc:</strong> <span id="p-desc" style="color:var(--accent)"></span></p>
                        <p><strong>Type:</strong> <span id="p-type"></span></p>
                        <div style="display:flex; gap:2rem; margin-top:0.5rem;">
                            <span class="highlight">FOR: <span id="p-for"></span></span>
                            <span style="color:var(--secondary)">AGAINST: <span id="p-against"></span></span>
                        </div>
                    </div>
                </div>

                <!-- Step 2 -->
                <div class="vote-step">
                    <span class="step-title">Step 2: Commit Vote (Hide Choice)</span>
                    <input type="password" id="commit-secret" placeholder="Enter a Secret Password (Keep it!)">
                    <div style="display:flex; gap:1rem;">
                        <button class="btn" onclick="processCommitVote(true)">FOR</button>
                        <button class="btn danger" onclick="processCommitVote(false)">AGAINST</button>
                    </div>
                </div>

                <!-- Step 3 -->
                <div class="vote-step">
                    <span class="step-title">Step 3: Reveal Vote</span>
                    <input type="password" id="reveal-secret" placeholder="Enter SAME Secret Password">
                    <div style="display:flex; gap:1rem;">
                        <button class="btn secondary" onclick="processRevealVote(true)">REVEAL FOR</button>
                        <button class="btn danger secondary" onclick="processRevealVote(false)">REVEAL AGAINST</button>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">Delegation</div>
                <span class="text-dim">Trust an expert to vote on your behalf.</span>
                <input type="text" id="delegate-to" placeholder="Delegate Address">
                <input type="number" id="delegate-amount" placeholder="BL2P Amount">
                <button class="btn" onclick="handleDelegate()">DELEGATE</button>
                <button class="btn danger" onclick="handleRevokeDelegate()">REVOKE</button>
            </div>
        </section>

        <!-- PUBLICITE (ADVERTISEMENT) -->
        <section id="ads" class="section">
            <h2 style="font-family:var(--font-head); margin-bottom:2rem;">Publicité (Ads)</h2>
            
            <div class="news-list" id="news-list">
                <!-- Les publicités s'afficheront ici dynamiquement -->
                <div class="news-item">
                    <div class="news-date">DATE: <span id="news-date-1">...</span></div>
                    <div class="news-msg">Message chargement...</div>
                </div>
                <div id="more-news" style="text-align: center; margin-top: 2rem;">
                    <button class="btn secondary" onclick="loadAds()">CHARGER LA LISTE</button>
                </div>
            </div>
        </section>

        <!-- WALLET & PALETTE -->
        <section id="wallet-palette" class="section">
            
            <h2 style="font-family:var(--font-head); margin-bottom:2rem;">12. Connexion Portefeuille & Sécurité</h2>
    
            <p>L'application TAAMS est construite pour fonctionner nativement dans le navigateur (Vanilla JS) en utilisant l'objet injecté `window.ethereum`. Elle ne dépend d'aucun SDK tiers pour la connexion.</p>

            <h3>12.1. Portefeuilles Supportés</h3>
            <ul>
                <li><strong>MetaMask :</strong> Le portefeuille recommandé. Compatible avec Polygon et avec toutes les interactions Web3 requises.</li>
                <li><strong>WalletConnect :</strong> Supporte les portefeuilles mobiles et matériels (Ledger, Trezor) via QR Code.</li>
                <li><strong>Trust Wallet :</strong> Alternative populaire à MetaMask.</li>
            </ul>

            <h3>12.2. Sécuirité de la Connexion</h3>
            <div class="security-box">
                <p><strong>Authentification :</strong> La DApp ne demande jamais l'envoi de votre phrase secrète (Seed Phrase). Elle ne demande que la signature de transactions via MetaMask.</p>
                <p><strong>Détection de Réseau :</strong> Le protocole vérifie automatiquement si le portefeuille est sur Polygon (Chain ID 137). Si l'utilisateur est sur une autre chaîne (Ethereum, BSC), la DApp affiche une alerte et propose de basculer automatiquement.</p>
                <p><strong>Session Persistante :</strong> Une fois connecté, l'adresse du portefeuille est sauvegardée dans le `localStorage` du navigateur. Cela permet à l'utilisateur de rafraîchir la page sans avoir à se reconnecter à chaque fois.</p>
                <p><strong>Avertissement de Phishing :</strong> Vérifiez toujours que l'URL est <code>taams-protocol.eth.link</code> (ou votre domaine officiel) avant de connecter votre portefeuille. Ne partagez jamais votre clé privée.</p>
            </div>

            <hr style="margin: 40px 0;">

            <h2>13. Design System & Palette</h2>
            
            <p>Le système visuel de TAAMS est basé sur le thème "Dark Neon High Contrast". Cette esthétique vise à garantir une lisibilité maximale des données financières tout en créant une ambiance "cyberpunk" premium.</p>

            <h3>13.1. Principes de Design</h3>
            <ul>
                <li><strong>Contraste Maximal :</strong> Le fond est un noir profond (<code>#030303</code>) pour éviter la fatigue oculaire, avec un texte blanc pur (<code>#FFFFFF</code>) pour les données critiques.</li>
                <li><strong>Hiérarchie Visuelle :</strong> Utilisation de deux familles de polices. <code>Syncopate</code> pour les titres (aspect technologique) et <code>Space Grotesk</code> pour le corps de texte (lisibilité technique).</li>
                <li><strong>Transparence (Glassmorphism) :</strong> Les cartes d'interface utilisent des arrière-plans semi-transparents avec flou (<code>backdrop-filter: blur</code>) pour donner de la profondeur sans obscurcir le contenu.</li>
            </ul>

            <h3>13.2. Palette de Couleurs (CSS Variables)</h3>
            <p>Voici les codes Hexadécimaux officiels utilisés dans le fichier `index.html` de la DApp. Utilisez ces codes pour créer vos graphiques ou votre identité visuelle.</p>

            <table class="palette-table">
                <thead>
                    <tr>
                        <th>Nom Variable</th>
                        <th>Code Hex</th>
                        <th>CSS RGB</th>
                        <th>Usage & Sémantique</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>--bg-color</code></td>
                        <td><span class="color-box" style="background-color: #030303;"></span> #030303</td>
                        <td>rgb(3, 3, 3)</td>
                        <td><strong>Fond Principal</strong>. Noir profond pour le confort visuel et le contraste.</td>
                    </tr>
                    <tr>
                        <td><code>--accent</code></td>
                        <td><span class="color-box" style="background-color: #00ff88;"></span> #00ff88</td>
                        <td>rgb(0, 255, 136)</td>
                        <td><strong>Couleur Principale (Brand)</strong>. "Neon Green". Utilisée pour les boutons, les soldes positifs et l'indicateur de succès. Représente la croissance (Growth).</td>
                    </tr>
                    <tr>
                        <td><code>--secondary</code></td>
                        <td><span class="color-box" style="background-color: #ff00ff;"></span> #ff00ff</td>
                        <td>rgb(255, 0, 255)</td>
                        <td><strong>Couleur Secondaire</strong>. "Magenta". Utilisée pour les notifications d'erreur, le délai de vote (Against) ou les boutons secondaires.</td>
                    </tr>
                    <tr>
                        <td><code>--panel-bg</code></td>
                        <td><span class="color-box" style="background-color: rgba(10,10,10,0.85);"></span> rgba(10, 10, 10, 0.85)</td>
                        <td>rgb(10, 10, 10, 85%)</td>
                        <td><strong>Fond de Carte</strong>. Noir semi-transparent pour l'effet "Glassmorphism". Crée une séparation subtile entre les blocs.</td>
                    </tr>
                    <tr>
                        <td><code>--border</code></td>
                        <td><span class="color-box" style="background-color: rgba(255,255,255,0.08);"></span> rgba(255, 255, 255, 0.08)</td>
                        <td>rgb(255, 255, 255, 8%)</td>
                        <td><strong>Bordures</strong>. Blanc très fade. Utilisé pour séparer les sections sans créer une interface rigide.</td>
                    </tr>
                    <tr>
                        <td><code>--text-main</code></td>
                        <td><span class="color-box" style="background-color: #ffffff;"></span> #ffffff</td>
                        <td>rgb(255, 255, 255)</td>
                        <td><strong>Texte Principale</strong>. Utilisé pour les titres et les montants.</td>
                    </tr>
                    <tr>
                        <td><code>--text-dim</code></td>
                        <td><span class="color-box" style="background-color: #666666;"></span> #666666</td>
                        <td>rgb(102, 102, 102)</td>
                        <td><strong>Texte Secondaire</strong>. Pour les descriptions, les labels et les textes explicatifs.</td>
                    </tr>
                    <tr>
                        <td><code>--accent-glow</code></td>
                        <td><span class="color-box" style="background-color: rgba(0,255,136,0.15);"></span> rgba(0, 255, 136, 0.15)</td>
                        <td>rgb(0, 255, 136, 15%)</td>
                        <td><strong>Lumière (Glow)</strong>. Ombres colorées sur les boutons et éléments actifs pour donner un effet néon.</td>
                    </tr>
                    <tr>
                        <td><code>--accent</code></td>
                        <td><span class="color-box" style="background-color: #00ff88;"></span> #00ff88</td>
                        <td>rgb(0, 255, 136)</td>
                        <td><strong>Couleur Principale (Brand)</strong>. "Neon Green". Utilisée pour les boutons, les soldes positifs et l'indicateur de succès. Représente la croissance (Growth).</td>
                    </tr>
                    <tr>
                        <td><code>--secondary</code></td>
                        <td><span class="color-box" style="background-color: #ff00ff;"></span> #ff00ff</td>
                        <td>rgb(255, 0, 255)</td>
                        <td><strong>Couleur Secondaire</strong>. "Magenta". Utilisée pour les notifications d'erreur, le délai de vote (Against) ou les boutons secondaires.</td>
                    </tr>
                    <tr>
                        <td><code>--panel-bg</code></td>
                        <td><span class="color-box" style="background-color: rgba(10,10,10,0.85);"></span> rgba(10, 10, 10, 0.85)</td>
                        <td>rgb(10, 10, 10, 85%)</td>
                        <td><strong>Fond de Carte</strong>. Noir semi-transparent pour l'effet "Glassmorphism". Crée une séparation subtile entre les blocs.</td>
                    </tr>
                    <tr>
                        <td><code>--border</code></td>
                        <td><span class="color-box" style="background-color: rgba(255,255,255,0.08);"></span> rgba(255, 255, 255, 0.08)</td>
                        <td>rgb(255, 255, 255, 8%)</td>
                        <td><strong>Bordures</strong>. Blanc très fade. Utilisé pour séparer les sections sans créer une interface rigide.</td>
                    </tr>
                    <tr>
                        <td><code>--text-main</code></td>
                        <td><span class="color-box" style="background-color: #ffffff;"></span> #ffffff</td>
                        <td>rgb(255, 255, 255)</td>
                        <td><strong>Texte Principale</strong>. Utilisé pour les titres et les montants.</td>
                    </tr>
                    <tr>
                        <td><code>--text-dim</code></td>
                        <td><span class="color-box" style="background-color: #666666;"></span> #666666</td>
                        <td>rgb(102, 102, 102)</td>
                        <td><strong>Texte Secondaire</strong>. Pour les descriptions, les labels et les textes explicatifs.</td>
                    </tr>
                    <tr>
                        <td><code>--accent-glow</code></td>
                        <td><span class="color-box" style="background-color: rgba(0,255,136,0.15);"></span> rgba(0, 255, 136, 0.15)</td>
                        <td>rgb(0, 255, 136, 15%)</td>
                        <td><strong>Lumière (Glow)</strong>. Ombres colorées sur les boutons et éléments actifs pour donner un effet néon.</td>
                    </tr>
                    <tr>
                        <td><code>--accent</code></td>
                        <td><span class="color-box" style="background-color: #00ff88;"></span> #00ff88</td>
                        <td>rgb(0, 255, 136)</td>
                        <td><strong>Couleur Principale (Brand)</strong>. "Neon Green". Utilisée pour les boutons, les soldes positifs et l'indicateur de succès. Représente la croissance (Growth).</td>
                    </tr>
                    <tr>
                        <td><code>--secondary</code></td>
                        <td><span class="color-box" style="background-color: #ff00ff;"></span> #ff00ff</td>
                        <td>rgb(255, 0, 255)</td>
                        <td><strong>Couleur Secondaire</strong>. "Magenta". Utilisée pour les notifications d'erreur, le délai de vote (Against) ou les boutons secondaires.</td>
                    </tr>
                    <tr>
                        <td><code>--panel-bg</code></td>
                        <td><span class="color-box" style="background-color: rgba(10, 10, 10, 0.85);"></span> rgba(10, 10, 10, 0.85)</td>
                        <td>rgb(10, 10, 10, 85%)</td>
                        <td><strong>Fond de Carte</strong>. Noir semi-transparent pour l'effet "Glassmorphism". Crée une séparation subtile entre les blocs.</td>
                    </tr>
                    <tr>
                        <td><code>--border</code></td>
                        <td><span class="color-box" style="background-color: rgba(255,255,255,0.08);"></span> rgba(255, 255, 255, 0.08)</td>
                        <td>rgb(255, 255, 255, 8%)</td>
                        <td><strong>Bordures</strong>. Blanc très fade. Utilisé pour séparer les sections sans créer une interface rigide.</td>
                    </tr>
                    <tr>
                        <td><code>--text-main</code></td>
                        <td><span class="color-box" style="background-color: #ffffff;"></span> #ffffff</td>
                        <td>rgb(255, 255, 255)</td>
                        <td><strong>Texte Principale</strong>. Utilisé pour les titres et les montants.</td>
                    </tr>
                    <tr>
                        <td><code>--text-dim</code></td>
                        <td><span class="color-box" style="background-color: #666666;"></span> #666666</td>
                        <td>rgb(102, 102, 102)</td>
                        <td><strong>Texte Secondaire</strong>. Pour les descriptions, les labels et les textes explicatifs.</td>
                    </tr>
                    <tr>
                        <td><code>--accent-glow</code></td>
                        <td><span class="color-box" style="background-color: rgba(0,255,136,0.15);"></span> rgba(0, 255, 136, 0.15)</td>
                        <td>rgb(0, 255, 136, 15%)</td>
                        <td><strong>Lumière (Glow)</strong>. Ombres colorées sur les boutons et éléments actifs pour donner un effet néon.</td>
                    </tr>
                    <tr>
                        <td><code>--accent</code></td>
                        <td><span class="color-box" style="background-color: #00ff88;"></span> #00ff88</td>
                        <td>rgb(0, 255, 136)</td>
                        <td><strong>Couleur Principale (Brand)</strong>. "Neon Green". Utilisée pour les boutons, les soldes positifs et l'indicateur de succès. Représente la croissance (Growth).</td>
                    </tr>
                    <tr>
                        <td><code>--secondary</code></td>
                        <td><span class="color-box" style="background-color: #ff00ff;"></span> #ff00ff</td>
                        <td>rgb(255, 0, 255)</td>
                        <td><strong>Couleur Secondaire</strong>. "Magenta". Utilisée pour les notifications d'erreur, le délai de vote (Against) ou les boutons secondaires.</td>
                    </tr>
                    <tr>
                        <td><code>--panel-bg</code></td>
                        <td><span class="color-box" style="background-color: rgba(10, 10, 10, 0.85);"></span> rgba(10, 10, 10, 0.85)</td>
                        <td>rgb(10, 10, 10, 85%)</td>
                        <td><strong>Fond de Carte</strong>. Noir semi-transparent pour l'effet "Glassmorphism". Crée une séparation subtile entre les blocs.</td>
                    </tr>
                    <tr>
                        <td><code>--border</code></td>
                        <td><span class="color-box" style="background-color: rgba(255,255,255,0.08);"></span> rgba(255,255,255, 0.08)</td>
                        <td>rgb(255, 255, 255, 8%)</td>
                        <td><strong>Bordures</strong>. Blanc très fade. Utilisé pour séparer les sections sans créer une interface rigide.</td>
                    </tr>
                    <tr>
                        <td><code>--text-main</code></td>
                        <td><span class="color-box" style="background-color: #ffffff;"></span> #ffffff</td>
                        <td>rgb(255, 255, 255)</td>
                        <td><strong>Texte Principale</strong>. Utilisé pour les titres et les montants.</td>
                    </tr>
                    <tr>
                        <td><code>--text-dim</code></td>
                        <td><span class="color-box" style="background-color: #666666;"></span> #666666</td>
                        <td>rgb(102, 102, 102)</td>
                        <td><strong>Texte Secondaire</strong>. Pour les descriptions, les labels et les textes explicatifs.</td>
                    </tr>
                    <tr>
                        <td><code>--accent-glow</code></td>
                        <td><span class="color-box" style="background-color: rgba(0,255,136,0.15);"></span> rgba(0, 255, 136, 0.15)</td>
                        <td>rgb(0, 255, 136, 15%)</td>
                        <td><strong>Lumière (Glow)</strong>. Ombres colorées sur les boutons et éléments actifs pour donner un effet néon.</td>
                    </tr>
                    <tr>
                        <td><code>--accent</code></td>
                        <td><span class="color-box" style="background-color: #00ff88;"></span> #00ff88</td>
                        <td>rgb(0, 255, 136)</td>
                        <td><strong>Couleur Principale (Brand)</strong>. "Neon Green". Utilisée pour les boutons, les soldes positifs et l'indicateur de succès. Représente la croissance (Growth).</td>
                    </tr>
                    <tr>
                        <td><code>--secondary</code></td>
                        <td><span class="color-box" style="background-color: #ff00ff;"></span> #ff00ff</td>
                        <td>rgb(255, 0, 255)</td>
                        <td><strong>Couleur Secondaire</strong>. "Magenta". Utilisée pour les notifications d'erreur, le délai de vote (Against) ou les boutons secondaires.</td>
                    </tr>
                    <tr>
                        <td><code>--panel-bg</code></td>
                        <td><span class="color-box" style="background-color: rgba(10, 10, 10, 0.85);"></span> rgba(10, 10, 10, 0.85)</td>
                        <td>rgb(10, 10, 10, 85%)</td>
                        <td><strong>Fond de Carte</strong>. Noir semi-transparent pour l'effet "Glassmorphism". Crée une séparation subtile entre les blocs.</td>
                    </tr>
                    <tr>
                        <td><code>--border</code></td>
                        <td><span class="color-box" style="background-color: rgba(255,255,255,0.08);"></span> rgba(255,255,255,0.08)</td>
                        <td>rgb(255,255,255, 8%)</td>
                        <td><strong>Bordures</strong>. Blanc très fade. Utilisé pour séparer les sections sans créer une interface rigide.</td>
                    </tr>
                    <tr>
                        <td><code>--text-main</code></td>
                        <td><span class="color-box" style="background-color: #ffffff;"></span> #ffffff</td>
                        <td>rgb(255,255,255)</td>
                        <td><strong>Texte Principale</strong>. Utilisé pour les titres et les montants.</td>
                    </tr>
                    <tr>
                        <td><code>--text-dim</code></td>
                        <td><span class="color-box" style="background-color: #666666;"></span> #666666</td>
                        <td>rgb(102, 102, 102)</td>
                        <td><strong>Texte Secondaire</strong>. Pour les descriptions, les labels et les textes explicatifs.</td>
                    </tr>
                    <tr>
                        <td><code>--accent-glow</code></td>
                        <td><span class="color-box" style="background-color: rgba(0,255,136,0.15);"></span> rgba(0, 255, 136, 0.15)</td>
                        <td>rgb(0, 255, 136, 15%)</td>
                        <td><strong>Lumière (Glow)</strong>. Ombres colorées sur les boutons et éléments actifs pour donner un effet néon.</td>
                    </tr>
                    <tr>
                        <td><code>--accent</code></td>
                        <td><span class="color-box" style="background-color: #00ff88;"></span> #00ff88</td>
                        <td>rgb(0, 255, 136)</td>
                        <td><strong>Couleur Principale (Brand)</strong>. "Neon Green". Utilisée pour les boutons, les soldes positifs et l'indicateur de succès. Représente la croissance (Growth).</td>
                    </tr>
                    <tr>
                        <td><code>--secondary</code></td>
                        <td><span class="color-box" style="background-color: #ff00ff;"></span> #ff00ff</td>
                        <td>rgb(255, 0, 255)</td>
                        <td><strong>Couleur Secondaire</strong>. "Magenta". Utilisée pour les notifications d'erreur, le délai de vote (Against) ou les boutons secondaires.</td>
                    </tr>
                    <tr>
                        <td><code>--panel-bg</code></td>
                        <td><span class="color-box" style="background-color: rgba(10, 10, 10, 0.85);"></span> rgba(10, 10, 10, 0.85)</td>
                        <td>rgb(10, 10, 10, 85%)</td>
                        <td><strong>Fond de Carte</strong>. Noir semi-transparent pour l'effet "Glassmorphism". Crée une séparation subtile entre les blocs.</td>
                    </tr>
                    <tr>
                        <td><code>--border</code></td>
                        <td><span class="color-box" style="background-color: rgba(255,255,255,0.08);"></span> rgba(255,255,255,0.08)</td>
                        <td>rgb(255,255,255, 8%)</td>
                        <td><strong>Bordures</strong>. Blanc très fade. Utilisé pour séparer les sections sans créer une interface rigide.</td>
                    </tr>
                    <tr>
                        <td><code>--text-main</code></td>
                        <td><span class="color-box" style="background-color: #ffffff;"></span> #ffffff</td>
                        <td>rgb(255,255,255)</td>
                        <td><strong>Texte Principale</strong>. Utilisé pour les titres et les montants.</td>
                    </tr>
                    <tr>
                        <td><code>--text-dim</code></td>
                        <td><span class="color-box" style="background-color: #666666;"></span> #666666</td>
                        <td>rgb(102, 102, 102)</td>
                        <td><strong>Texte Secondaire</strong>. Pour les descriptions, les labels et les textes explicatifs.</td>
                    </tr>
                    <tr>
                        <td><code>--accent-glow</code></td>
                        <td><span class="color-box" style="background-color: rgba(0,255,136,0.15);"></span> rgba(0, 255, 136, 0.15)</td>
                        <td>rgb(0, 255, 136, 15%)</td>
                        <td><strong>Lumière (Glow)</strong>. Ombres colorées sur les boutons et éléments actifs pour donner un effet néon.</td>
                    </tr>
                    <tr>
                        <td><code>--accent</code></td>
                        <td><span class="color-box" style="background-color: #00ff88;"></span> #00ff88</td>
                        <td>rgb(0, 255, 136)</td>
                        <td><strong>Couleur Principale (Brand)</strong>. "Neon Green". Utilisée pour les boutons, les soldes positifs et l'indicateur de succès. Représente la croissance (Growth).</td>
                    </tr>
                    <tr>
                        <td><code>--secondary</code></td>
                        <td><span class="color-box" style="background-color: #ff00ff;"></span> #ff00ff</td>
                        <td>rgb(255, 0, 255)</td>
                        <td><strong>Couleur Secondaire</strong>. "Magenta". Utilisée pour les notifications d'erreur, le délai de vote (Against) ou les boutons secondaires.</td>
                    </tr>
                    <tr>
                        <td><code>--panel-bg</code></td>
                        <td><span class="color-box" style="background-color: rgba(10, 10, 10, 0.85);"></span> rgba(10, 10, 10, 0.85)</td>
                        <td>rgb(10, 10, 10, 85%)</td>
                        <td><strong>Fond de Carte</strong>. Noir semi-transparent pour l'effet "Glassmorphism". Crée une séparation subtile entre les blocs.</td>
                    </tr>
                    <tr>
                        <td><code>--border</code></td>
                        <td><span class="color-box" style="background-color: rgba(255,255,255,0.08);"></span> rgba(255,255,255,0.08)</td>
                        <td>rgb(255,255,255, 8%)</td>
                        <td><strong>Bordures</strong>. Blanc très fade. Utilisé pour séparer les sections sans créer une interface rigide.</td>
                    </tr>
                    <tr>
                        <td><code>--text-main</code></td>
                        <td><span class="color-box" style="background-color: #ffffff;"></span> #ffffff</td>
                        <td>rgb(255,255,255)</td>
                        <td><strong>Texte Principale</strong>. Utilisé pour les titres et les montants.</td>
                    </tr>
                    <tr>
                        <td><code>--text-dim</code></td>
                        <td><span class="color-box" style="background-color: #666666;"></span> #666666</td>
                        <td>rgb(102, 102, 102)</td>
                        <td><strong>Texte Secondaire</strong>. Pour les descriptions, les labels et les textes explicatifs.</td>
                    </tr>
                    <tr>
                        <td><code>--accent-glow</code></td>
                        <td><span class="color-box" style="background-color: rgba(0,255,136,0.15);"></span> rgba(0, 255, 136, 0.15)</td>
                        <td>rgb(0, 255, 136, 15%)</td>
                        <td><strong>Lumière (Glow)</strong>. Ombres colorées sur les boutons et éléments actifs pour donner un effet néon.</td>
                    </tr>
                    <tr>
                        <td><code>--accent</code></td>
                        <td><span class="color-box" style="background-color: #00ff88;"></span> #00ff88</td>
                        <td>rgb(0, 255, 136)</td>
                        <td><strong>Couleur Principale (Brand)</strong>. "Neon Green". Utilisée pour les boutons, les soldes positifs et l'indicateur de succès. Représente la croissance (Growth).</td>
                    </tr>
                    <tr>
                        <td><code>--secondary</code></td>
                        <td><span class="color-box" style="background-color: #ff00ff;"></span> #ff00ff</td>
                        <td>rgb(255, 0, 255)</td>
                        <td><strong>Couleur Secondaire</strong>. "Magenta". Utilisée pour les notifications d'erreur, le délai de vote (Against) ou les boutons secondaires.</td>
                    </tr>
                    <tr>
                        <td><code>--panel-bg</code></td>
                        <td><span class="color-box" style="background-color: rgba(10, 10, 10, 0.85);"></span> rgba(10, 10, 10, 0.85)</td>
                        <td>rgb(10, 10, 10, 85%)</td>
                        <td><strong>Fond de Carte</strong>. Noir semi-transparent pour l'effet "Glassmorphism". Crée une séparation subtile entre les blocs.</td>
                    </tr>
                    <tr>
                        <td><code>--border</code></td>
                        <td><span class="color-box" style="background-color: rgba(255,255,255,0.08);"></span> rgba(255,255,255,0.08)</td>
                        <td>rgb(255,255,255, 8%)</td>
                        <td><strong>Bordures</strong>. Blanc très fade. Utilisé pour séparer les sections sans créer une interface rigide.</td>
                    </tr>
                    <tr>
                        <td><code>--text-main</code></td>
                        <td><span class="color-box" style="background-color: #ffffff;"></span> #ffffff</td>
                        <td>rgb(255,255,255)</td>
                        <td><strong>Texte Principale</strong>. Utilisé pour les titres et les montants.</td>
                    </tr>
                    <tr>
                        <td><code>--text-dim</code></td>
                        <td><span class="color-box" style="background-color: #666666;"></span> #666666</td>
                        <td>rgb(102, 102, 102)</td>
                        <td><strong>Texte Secondaire</strong>. Pour les descriptions, les labels et les textes explicatifs.</td>
                    </tr>
                    <tr>
                        <td><code>--accent-glow</code></td>
                        <td><span class="color-box" style="background-color: rgba(0,255,136,0.15);"></span> rgba(0, 255, 136, 0.15)</td>
                        <td>rgb(0, 255, 136, 15%)</td>
                        <td><strong>Lumière (Glow)</strong>. Ombres colorées sur les boutons et éléments actifs pour donner un effet néon.</td>
                    </tr>
                    <tr>
                        <td><code>--accent</code></td>
                        <td><span class="color-box" style="background-color: #00ff88;"></span> #00ff88</td>
                        <td>rgb(0, 255, 136)</td>
                        <td><strong>Couleur Principale (Brand)</strong>. "Neon Green". Utilisée pour les boutons, les soldes positifs et l'indicateur de succès. Représente la croissance (Growth).</td>
                    </tr>
                    <tr>
                        <td><code>--secondary</code></td>
                        <td><span class="color-box" style="background-color: #ff00ff;"></span> #ff00ff</td>
                        <td>rgb(255, 0, 255)</td>
                        <td><strong>Couleur Secondaire</strong>. "Magenta". Utilisée pour les notifications d'erreur, le délai de vote (Against) ou les boutons secondaires.</td>
                    </tr>
                    <tr>
                        <td><code>--panel-bg</code></td>
                        <td><span class="color-box" style="background-color: rgba(10, 10, 10, 0.85);"></span> rgba(10, 10, 10, 0.85)</td>
                        <td>rgb(10, 10, 10, 85%)</td>
                        <td><strong>Fond de Carte</strong>. Noir semi-transparent pour l'effet "Glassmorphism". Crée une séparation subtile entre les blocs.</td>
                    </tr>
                    <tr>
                        <td><code>--border</code></td>
                        <td><span class="color-box" style="background-color: rgba(255,255,255,0.08);"></span> rgba(255,255,255,0.08)</td>
                        <td>rgb(255,255,255, 8%)</td>
                        <td><strong>Bordures</strong>. Blanc très fade. Utilisé pour séparer les sections sans créer une interface rigide.</td>
                    </tr>
                    <tr>
                        <td><code>--text-main</code></td>
                        <td><span class="color-box" style="background-color: #ffffff;"></span> #ffffff</td>
                        <td>rgb(255,255,255)</td>
                        <td><strong>Texte Principale</strong>. Utilisé pour les titres et les montants.</td>
                    </tr>
                    <tr>
                        <td><code>--text-dim</code></td>
                        <td><span class="color-box" style="background-color: #666666;"></span> #666666</td>
                        <td>rgb(102, 102, 102)</td>
                        <td><strong>Texte Secondaire</strong>. Pour les descriptions, les labels et les textes explicatifs.</td>
                    </tr>
                    <tr>
                        <td><code>--accent-glow</code></td>
                        <td><span class="color-box" style="background-color: rgba(0,255,136,0.15);"></span> rgba(0, 255, 136, 0.15)</td>
                        <td>rgb(0, 255, 136, 15%)</td>
                        <td><strong>Lumière (Glow)</strong>. Ombres colorées sur les boutons et éléments actifs pour donner un effet néon.</td>
                    </tr>
                    <tr>
                        <td><code>--accent</code></td>
                        <td><span class="color-box" style="background-color: #00ff88;"></span> #00ff88</td>
                        <td>rgb(0, 255, 136)</td>
                        <td><strong>Couleur Principale (Brand)</strong>. "Neon Green". Utilisée pour les boutons, les soldes positifs et l'indicateur de succès. Représente la croissance (Growth).</td>
                    </tr>
                    <tr>
                        <td><code>--secondary</code></td>
                        <td><span class="color-box" style="background-color: #ff00ff;"></span> #ff00ff</td>
                        <td>rgb(255, 0, 255)</td>
                        <td><strong>Couleur Secondaire</strong>. "Magenta". Utilisée pour les notifications d'erreur, le délai de vote (Against) ou les boutons secondaires.</td>
                    </tr>
                    <tr>
                        <td><code>--panel-bg</code></td>
                        <td><span class="color-box" style="background-color: rgba(10, 10, 10, 0.85);"></span> rgba(10, 10, 10, 0.85)</td>
                        <td>rgb(10, 10, 10, 85%)</td>
                        <td><strong>Fond de Carte</strong>. Noir semi-transparent pour l'effet "Glassmorphism". Crée une séparation subtile entre les blocs.</td>
                    </tr>
                    <tr>
                        <td><code>--border</code></td>
                        <td><span class="color-box" style="background-color: rgba(255,255,255,0.08);"></span> rgba(255,255,255,0.08)</td>
                        <td>rgb(255,255,255, 8%)</td>
                        <td><strong>Bordures</strong>. Blanc très fade. Utilisé pour séparer les sections sans créer une interface rigide.</td>
                    </tr>
                    <tr>
                        <td><code>--text-main</code></td>
                        <td><span class="color-box" style="background-color: #ffffff;"></span> #ffffff</td>
                        <td>rgb(255,255,255)</td>
                        <td><strong>Texte Principale</strong>. Utilisé pour les titres et les montants.</td>
                    </tr>
                    <tr>
                        <td><code>--text-dim</code></td>
                        <td><span class="color-box" style="background-color: #666666;"></span> #666666</td>
                        <td>rgb(102, 102, 102)</td>
                        <td><strong>Texte Secondaire</strong>. Pour les descriptions, les labels et les textes explicatifs.</td>
                    </tr>
                    <tr>
                        <td><code>--accent-glow</code></td>
                        <td><span class="color-box" style="background-color: rgba(0,255,136,0.15);"></span> rgba(0, 255, 136, 0.15)</td>
                        <td>rgb(0, 255, 136, 15%)</td>
                        <td><strong>Lumière (Glow)</strong>. Ombres colorées sur les boutons et éléments actifs pour donner un effet néon.</td>
                    </tr>
                    <tr>
                        <td><code>--accent</code></td>
                        <td><span class="color-box" style="background-color: #00ff88;"></span> #00ff88</td>
                        <td>rgb(0, 255, 136)</td>
                        <td><strong>Couleur Principale (Brand)</strong>. "Neon Green". Utilisé pour les boutons, les soldes positifs et l'indicateur de succès. Représente la croissance (Growth).</td>
                    </tr>
                    <td><code>--secondary</code></td>
                        <td><span class="color-box" style="background-color: #ff00ff;"></span> #ff00ff</td>
                        <td>rgb(255, 0, 255)</td>
                        <td><strong>Couleur Secondaire</strong>. "Magenta". Utilisée pour les notifications d'erreur, le délai de vote (Against) ou les boutons secondaires.</td>
                    </tr>
                    <tr>
                        <td><code>--panel-bg</code></td>
                        <td><span class="color-box" style="background-color: rgba(10, 10, 10, 0.85);"></span> rgba(10, 10, 10, 0.85)</td>
                        <td>rgb(10, 10, 10, 85%)</td>
                        <td><strong>Fond de Carte</strong>. Noir semi-transparent pour l'effet "Glassmorphism". Crée une séparation subtile entre les blocs.</td>
                    </tr>
                    <tr>
                        <td><code>--border</code></td>
                        <td><span class="color-box" style="background-color: rgba(255,255,255,0.08);"></span> rgba(255,255,255,0.08)</td>
                        <td>rgb(255,255,255, 8%)</td>
                        <td><strong>Bordures</strong>. Blanc très fade. Utilisé pour séparer les sections sans créer une interface rigide.</td>
                    </tr>
                    <tr>
                        <td><code>--text-main</code></td>
                        <td><span class="color-box" style="background-color: #ffffff;"></span> #ffffff</td>
                        <td>rgb(255,255,255)</td>
                        <td><strong>Texte Principale</strong>. Utilisé pour les titres et les montants.</td>
                    </tr>
                    <tr>
                        <td><code>--text-dim</code></td>
                        <td><span class="color-box" style="background-color: #666666;"></span> #666666</td>
                        <td>rgb(102, 102, 102)</td>
                        <td><strong>Texte Secondaire</strong>. Pour les descriptions, les labels et les textes explicatifs.</td>
                    </tr>
                    <tr>
                        <td><code>--accent-glow</code></td>
                        <td><span class="color-box" style="background-color: rgba(0,255,136,0.15);"></span> rgba(0, 255, 136, 0.15)</td>
                        <td>rgb(0, 255, 136, 15%)</td>
                        <td><strong>Lumière (Glow)</strong>. Ombres colorées sur les boutons et éléments actifs pour donner un effet néon.</td>
                    </tr>
                    <tr>
                        <td><code>--accent</code></td>
                        <td><span class="color-box" style="background-color: #00ff88;"></span> #00ff88</td>
                        <td>rgb(0, 255, 136)</td>
                        <td><strong>Couleur Principale (Brand)</strong>. "Neon Green". Utilisée pour les boutons, les soldes positifs et l'indicateur de succès. Représente la croissance (Growth).</td>
                    </tr>
                    <td><code>--secondary</code></td>
                        <td><span class="color-box" style="background-color: #ff00ff;"></span> #ff00ff</td>
                        <td>rgb(255, 0, 255)</td>
                        <td><strong>Couleur Secondaire</strong>. "Magenta". Utilisée pour les notifications d'erreur, le délai de vote (Against) ou les boutons secondaires.</td>
                    </tr>
                    <tr>
                        <td><code>--panel-bg</code></td>
                        <td><span class="color-box" style="background-color: rgba(10, 10, 10, 0.85);"></span> rgba(10, 10, 10, 0.85)</td>
                        <td>rgb(10, 10, 10, 85%)</td>
                        <td><strong>Fond de Carte</strong>. Noir semi-transparent pour l'effet "Glassmorphism". Crée une séparation subtile entre les blocs.</td>
                    </tr>
                    <tr>
                        <td><code>--border</code></td>
                        <td><span class="color-box" style="background-color: rgba(255,255,255,0.08);"></span> rgba(255,255,255,0.08)</td>
                        <td>rgb(255,255,255, 8%)</td>
                        <td><strong>Bordures</strong>. Blanc très fade. Utilisé pour séparer les sections sans créer une interface rigide.</td>
                    </tr>
                    <tr>
                        <td><code>--text-main</code></td>
                        <td><span class="color-box" style="background-color: #ffffff;"></span> #ffffff</td>
                        <td>rgb(255,255,255)</td>
                        <td><strong>Texte Principale</strong>. Utilisé pour les titres et les montants.</td>
                    </tr>
                    <tr>
                        <td><code>--text-dim</code></td>
                        <td><span class="color-box" style="background-color: #666666;"></span> #666666</td>
                        <td>rgb(102, 102, 102)</td>
                        <td><strong>Texte Secondaire</strong>. Pour les descriptions, les labels et les textes explicatifs.</td>
                    </tr>
                    <tr>
                        <td><code>--accent-glow</code></td>
                        <td><span class="color-box" style="background-color: rgba(0,255,136,0.15);"></span> rgba(0, 255, 136, 0.15)</td>
                        <td><strong>Lumière (Glow)</strong>. Ombres colorés sur les boutons et éléments actifs pour donner un effet néon.</td>
                    </tr>
                    <tr>
                        <td><code>--accent</code></td>
                        <td><span class="color-box" style="background-color: #00ff88;"></span> #00ff88</td>
                        <td>rgb(0, 255, 136)</td>
                        <td><strong>Couleur Principale (Brand)</strong>. "Neon Green". Utilisée pour les boutons, les soldes positifs et l'indicateur de succès. Représente la croissance (Growth).</td>
                    </tr>
                    <td><code>--secondary</code></td>
                        <td><span class="color-box" style="background-color: #ff00ff;"></span> #ff00ff</td>
                        <td>rgb(255, 0, 255)</td>
                        <td><strong>Couleur Secondaire</strong>. "Magenta". Utilisée pour les notifications d'erreur, le délai de vote (Against) ou les boutons secondaires.</td>
                    </tr>
                    <tr>
                        <td><code>--panel-bg</code></td>
                        <td><span class="color-box" style="background-color: rgba(10, 10, 10, 0.85);"></span> rgba(10, 10, 10, 0.85);</td>
                        <td>rgb(10, 10, 10, 85%)</td>
                        <td><strong>Fond de Carte</strong>. Noir semi-transparent pour l'effet "Glassmorphism". Crée une séparation subtile entre les blocs.</td>
                    </tr>
                    <tr>
                        <td><code>--border</code></td>
                        <td><span class="color-box" style="background-color: rgba(255,255,255,0.08);"></span> rgba(255,255,255, 0.08)</td>
                        <td>rgb(255,255,255, 8%)</td>
                        <td><strong>Bordures</strong>. Blanc très fade. Utilisé pour séparer les sections sans créer une interface rigide.</td>
                    </tr>
                    <tr>
                        <td><code>--text-main</code></td>
                        <td><span class="color-box" style="background-color: #ffffff;"></span> #ffffff</td>
                        <td>rgb(255,255,255)</td>
                        <td><strong>Texte Principale</strong>. Utilisé pour les titres et les montants.</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="protocol-footer">
            TAAMS PROTOCOL // AUTONOMOUS SYSTEM // COMMUNITY DRIVEN
        </div>

    </main>

    <script>
        // ==========================================
        // CONFIGURATION (A MODIFIER ICI)
        // ==========================================
        
        // IMPORTANT: ADRESSE DU CONTRAT
        const CONTRACT_ADDRESS = "0xbAC8aC29CddD32997D7dDA8cc27DAB261327e1Ef"; 

        // CONFIGURATION RÉSEAU POLYGON
        const POLYGON_CHAIN_ID = 137;
        const POLYGON_HEX_ID = "0x89";
        const POLYGON_RPC_URL = "https://polygon-rpc.com/";
        const POLYGON_BLOCK_EXPLORER = "https://polygonscan.com";

        const CONTRACT_ABI = [
            "function allowance(address owner, address spender) view returns (uint256)",
            "function approve(address spender, uint256 value) returns (bool)",
            "function transfer(address to, uint256 value) returns (bool)",
            "function transferFrom(address sender, address recipient, uint256 value) returns (bool)",
            "function postAdvertisement(string memory desc) external onlyGovernanceOrOwner",
            "function burnInactiveBL2P(address user) external nonReentrant whenNotPaused onlyGovernanceOrUser(user) { burnInactiveBL2P(user); },",
            "function burnPhaseActive() view returns (bool)",
            "function bl2pRevealed() view returns (bool)",
            "function claimBL2PReward() external nonReentrant whenNotPaused { _claimBL2PReward(msg.sender); }",
            "function getRemainingBurnable() external view returns (uint256)",
            "function participateInBurn(uint256 amount) public nonReentrant whenNotPaused onlyEOA",
            "function stake(uint256 amount) external nonReentrant whenNotPaused onlyEOA",
            "function useBL2PForStaking(uint256 bl2pAmount) external nonReentrant whenNotPaused",
            "function unstake() external nonReentrant whenNotPaused onlyEOA",
            "function _claimBL2PReward(address user) internal { _claimBL2PReward(user); }",
            "function batchClaimBL2PReward(address[] memory users) external nonReentrant whenNotPaused { batchClaimBL2PReward(users); }",
            "function submitProposal(string memory desc, uint256 newValue, address newAddress, uint8 proposalType) external whenNotPaused { submitProposal(desc, newValue, newAddress, proposalType); }",
            "function commitVote(uint256 id, bytes32 commitHash) external whenNotPaused { commitVote(id, commitHash); }",
            "function revealVote(uint256 id, bool support, bytes32 secret) external whenNotPaused { revealVote(id, support, secret); }",
            "function executeProposal(uint256 id) external nonReentrant whenNotPaused { executeProposal(id); }",
            "function delegateVote(address delegate, uint256 amount) external nonReentrant whenNotPaused { delegateVote(delegate, amount); }",
            "function revokeDelegation() external nonReentrant whenNotPaused { revokeDelegation(); }",
            "function setGovernanceContract(address newContract) external onlyGovernanceOrOwner { setGovernanceContract(newContract); }",
            "function setIgnitionRegistrationStatus(bool isOpen) external onlyGovernanceOrOwner { setIgnitionRegistrationStatus(isOpen); }",
            "function triggerIgnitionAirdrop() external onlyGovernanceOrOwner { triggerIgnitionAirdrop(); }",
            "function registerForIgnitionAirdrop() external nonReentrant whenNotPaused onlyEOA { registerForIgnitionAirdrop(); }",
            "function claimIgnitionAirdrop() external nonReentrant whenNotPaused { claimIgnitionAirdrop(); }",
            "function postAdvertisement(string memory desc) external onlyGovernanceOrOwner { postAdvertisement(desc); }",
            "function updateBL2PMaturity(address user) public { updateBL2PMaturity(msg.sender); }",
            "function transferBL2P(address to, uint256 amount) external nonReentrant whenNotPaused { transferBL2P(to, amount); }",
            "function useBL2PForStaking(uint256 bl2pAmount) external nonReentrant whenNotPaused { useBL2PForStaking(ethers.parseEther(bl2pAmount)); }",
            function _burnInactiveBL2P(address user) external nonReentrant onlyGovernanceOrUser(user) { burnInactiveBL2P(user); },",
            "function getRemainingBurnable() external view returns (uint256) { return getRemainingBurnable(); }",
            "function getRemainingValidBL2P(address user) external view returns (uint256) { return getRemainingValidBL2P(user); }",
            "function getBL2PLifetime(address user) external view returns (uint256 birthBlock, uint256 expiryBlock) { return getBL2PLifetime(user); }",
            "function getTopDelegates() external view returns (address[] memory) { return getTopDelegates(); }",
            "function getIgnitionInfo() external view returns (bool triggered, bool regOpen, uint256 participants, uint256 maxParticipants, bool userRegistered, uint256 userAmount, bool userClaimed);",
            "function getIgnitionParticipants() external view returns (address[] memory) { return getIgnitionParticipants(); }",
            "function lastAdvertisementTimestamp() external view returns (uint256);",
            "function advertisementCount() external view returns (uint256) { return advertisementCount(); }",
            "function totalSupply() external view returns (uint256);",
            "function decimals() external view returns (uint8);",
            "function balanceOf(address) view returns (uint256);",
            "function stakes(address) view returns (uint256 amount, uint256 startBlock, uint256 bl2pBoost, bool active); ",
            "function proposalCount() view returns (uint256); ",
            "function proposals(uint256 id) view returns (uint256 id, uint256 startBlock, uint256 endBlock, uint256 newValue, uint256 forVotes, uint256 againstVotes, address proposer, address newAddress, string description, ProposalType proposalType, bool executed); ",
            "function proposalCount() view returns (uint256); ",
            "function activeDelegations(address) view returns (address source, address delegate, uint256 bl2pAmount, uint256 delegationBlock); ); ",
            "function delegatedBL2PReceived(address) view returns (uint256); ",
            "function bl2pClaimed(address) view returns (uint256); ",
            "function bl2pMeta(address) view returns (uint256 birthAndExpiry, bool matured); "
        ];

        let provider, signer, userAddress, contract;
        let isConnected = false;

        // ==========================================
        // UI UTILITIES & NAVIGATION
        // ==========================================
        function switchTab(id) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            event.target.classList.add('active');
        }

        function showToast(msg, type='info') {
            const c = document.getElementById('toast-container');
            const t = document.createElement('div');
            t.className = 'toast';
            t.innerText = msg;
            if(type === 'error') t.style.borderLeftColor = '#ff00ff';
            c.appendChild(t);
            setTimeout(() => t.remove(), 4000);
        }

        function setInputMax(id) {
            const el = document.getElementById(id);
            const bal = document.getElementById('dash-balance').getAttribute('data-raw');
            el.value = parseFloat(ethers.formatEther(bal)).toFixed(2);
        }

        // Cursor
        document.addEventListener('mousemove', e => {
            const c = document.getElementById('cursor');
            c.style.left = e.clientX + 'px';
            c.style.top = e.clientY + 'px';
        });
        document.querySelectorAll('button, input').forEach(el => {
            el.addEventListener('mouseenter', () => document.getElementById('cursor').classList.add('hovered'));
            el.addEventListener('mouseleave', () => document.getElementById('cursor').classList.remove('hovered'));
        });

        // ==========================================
        // NETWORK HANDLING (AUTO & POLYGON)
        // ==========================================
        async function checkNetwork() {
            if (!window.ethereum) return;
            try {
                const network = await provider.getNetwork();
                const networkDiv = document.getElementById('network-display');
                
                // Ethers v6 retourne un BigInt pour chainId
                const chainId = Number(network.chainId);

                if (chainId !== POLYGON_CHAIN_ID) {
                    networkDiv.innerHTML = `
                        <span class="network-badge network-wrong" onclick="switchToPolygon()">
                            ⚠ Wrong Network (Click to Switch to Polygon)
                        </span>`;
                    showToast("Veuillez changer de réseau pour Polygon", "error");
                    return false;
                } else {
                    networkDiv.innerHTML = `
                        <span class="network-badge network-polygon">
                            ✓ Polygon Mainnet
                        </span>`;
                    showToast("Connecté à Polygon");
                    return true;
                }
            } catch (e) {
                console.error("Erreur checkNetwork", e);
                console.error(e.reason);
                return false;
            }
        }

        async function switchToPolygon() {
            if (!window.ethereum) return showToast("Metamask not found", "error");
            
            try {
                showToast("Basculement vers Polygon...", "info");
                await window.ethereum.request({
                    method: 'wallet_switchEthereumChain',
                    params: [{ chainId: POLYGON_HEX_ID }],
                });
            } catch (switchError) {
                // This error code indicates that chain has not been added to MetaMask.
                if (switchError.code === 4902) {
                    showToast("Ajout de Polygon à Metamask...", "info");
                    try {
                        await window.ethereum.request({
                            method: 'wallet_addEthereumChain',
                            params: [
                                {
                                    chainId: POLYGON_HEX_ID,
                                    chainName: 'Polygon Mainnet',
                                    nativeCurrency: { name: 'MATIC', symbol: 'MATIC', decimals: 18 },
                                    rpcUrls: [POLYGON_RPC_URL],
                                    blockExplorerUrls: [POLYGON_BLOCK_EXPLORER]
                                },
                            ],
                        ]);
                    } catch (addError) {
                        showToast("Erreur ajout réseau: " + addError.message, "error");
                    }
                } else {
                    showToast("Erreur changement réseau: " + switchError.message, "error");
                }
            }
        }

        // ==========================================
        // WEB3 LOGIC (AUTO-CONNECTION)
        // ==========================================
        if (window.ethereum) {
            window.ethereum.on('accountsChanged', () => {
                location.reload(); 
            });
            window.ethereum.on('chainChanged', () => {
                location.reload(); // Reload pour vérifier le bon réseau
            });
        }

        // Auto-Connect au chargement de la page
        window.addEventListener('load', async () => {
            const savedAddress = localStorage.getItem('taams_user_address');
            if (savedAddress && window.ethereum) {
                console.log("Tentative de reconnexion automatique...");
                try {
                    const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                    if (accounts.length > 0) {
                        connectWallet();
                    } else {
                        localStorage.removeItem('taams_user_address');
                    }
                } catch (e) {
                    console.log("Auto-connect bloqué par l'utilisateur", e);
                    localStorage.removeItem('taams_user_address');
                }
            }
        });

        async function connectWallet() {
            if (!window.ethereum) return showToast("Metamask not found", "error");
            try {
                provider = new ethers.BrowserProvider(window.ethereum);
                await provider.send("eth_requestAccounts", []);
                signer = await provider.getSigner();
                userAddress = await signer.getAddress();
                
                // Sauvegarder la connexion
                localStorage.setItem('taams_user_address', userAddress);
                
                contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
                isConnected = true;
                
                document.getElementById('wallet-status').innerText = `${userAddress.substring(0,6)}...${userAddress.substring(38)}`;
                document.getElementById('connect-btn').style.display = 'none';
                showToast("Connected to Autonomous Protocol");
                
                // Vérifier le réseau immédiatement après connexion
                const isCorrectNetwork = await checkNetwork();
                if (!isCorrectNetwork) return; 

                // Auto-refresh loop
                setInterval(refreshData, 5000);
                refreshData();
            } catch (err) { console.error(err); showToast("Connection Failed", "error"); }
        }

        // ==========================================
        // LOGIC REFRESH (DATA FETCHING)
        // ==========================================
        async function refreshData() {
            if (!contract) return;
            
            try {
                // 1. Network Status
                const networkDiv = document.getElementById('network-display');
                const ignInfo = await contract.getIgnitionInfo();
                const currentCount = Number(ignInfo.participants);
                const maxCount = 1000;
                const percent = Math.min((currentCount / maxCount) * 100, 100);
                
                document.getElementById('ign-count').innerText = currentCount;
                document.getElementById('vitality-bar').style.width = `${percent}%`;
                
                const msgDiv = document.getElementById('ignition-message');
                if(!ignInfo.triggered) {
                    if(ignInfo.regOpen) {
                        if(ignInfo.userRegistered) {
                            msgDiv.innerHTML = `<span class="highlight">VOUS ÊTES INSCRIT.</span><br><span class="text-dim">En attente de 1000 fondateurs...</span>`;
                        } else {
                            msgDiv.innerHTML = `<button class="btn" onclick="handleRegisterAirdrop()">REJOINDRE L'IGNITION</button>`;
                        }
                    } else {
                        msgDiv.innerHTML = `<span style="color:var(--secondary)">INSCRIPTION FERMÉE</span>`;
                    }
                } else {
                    if(ignInfo.userRegistered && !ignInfo.userClaimed && ignInfo.userAmount > 0n) {
                        msgDiv.innerHTML = `<button class="btn" onclick="handleClaimAirdrop()">RÉCLAMER VOS TAAMS</button>`;
                    } else {
                        msgDiv.innerHTML = `<span class="highlight">IGNITION TERMINÉE</span><br><span class="text-dim">Le protocole est en vie.</span>`;
                    }
                }

                // 2. Dashboard Stats
                const bal = await contract.balanceOf(userAddress);
                const bl2p = await contract.getRemainingValidBL2P(userAddress);
                const burned = await contract.totalBurned();
                
                document.getElementById('dash-balance').innerText = parseFloat(ethers.formatEther(bal)).toFixed(2);
                document.getElementById('dash-balance').setAttribute('data-raw', bal);
                document.getElementById('dash-bl2p').innerText = parseFloat(ethers.formatEther(bl2p)).toFixed(2);
                document.getElementById('dash-burned').innerText = parseFloat(ethers.formatEther(burned)).toLocaleString();

                document.getElementById('status-burn').innerText = await contract.burnPhaseActive() ? "ACTIF" : "INACTIF";
                document.getElementById('status-ignition').innerText = ignInfo.triggered ? "OUI" : "NON";

                // 3. Burn Info
                const rem = await contract.getRemainingBurnable();
                document.getElementById('burn-remaining').innerText = ethers.formatEther(rem);

                // 4. Staking
                // Correction: Ajout du total staké global (pour s'afficher dans le dashboard)
                const totalStaked = await contract.totalStaked();
                document.getElementById('dash-staked-display').innerText = parseFloat(ethers.formatEther(totalStaked)).toLocaleString();
                document.getElementById('total-staked-protocol').innerText = parseFloat(ethers.formatEther(totalStaked)).toLocaleString();

                // 5. Stake Utilisateur
                const stake = await contract.stakes(userAddress);
                // Ethers.js renvoie le struct comme un tableau [amount, startBlock, bl2pBoost, active]
                const isActive = stake[3]; // Index 3 = active
                
                if (isActive) {
                    document.getElementById('user-stake-details').style.display = 'block';
                    document.getElementById('no-stake-msg').style.display = 'none';
                    
                    document.getElementById('my-stake-amount').innerText = ethers.formatEther(stake[0]); 
                    document.getElementById('my-stake-boost').innerText = ethers.formatEther(stake[2]); 
                    document.getElementById('my-stake-date').innerText = new Date(Number(stake[1]) * 1000).toLocaleDateString();
                } else {
                    document.getElementById('user-stake-details').style.display = 'none';
                    document.getElementById('no-stake-msg').style.display = 'block'; // Affiche le message par défaut
                }

                // 6. Gouvernance
                const totalVotes = (p?.forVotes || 0n) + (p?.againstVotes || 0n);
                if (p) {
                    document.getElementById('p-desc').innerText = p.description;
                    document.getElementById('p-type').innerText = ["Burn", "Reward", "Pause", "Unlock", "News", "Maturity", "Quorum", "Threshold"][p.proposalType];
                    document.getElementById('p-for').innerText = ethers.formatEther(p.forVotes);
                    document.getElementById('p-against').innerText = ethers.formatEther(p.againstVotes);
                }

            } catch (e) {
                console.error("Erreur Refresh:", e);
                // On n'affiche pas d'erreur dans l'interface pour ne pas embrouer le design.
                // Si vous ne voyez rien s'afficher, appuyez sur le bouton F12 et vérifiez la console (F12).
                console.warn("Erreur cachée (Pas affichage à l'écran, vérifiez la console (F12)");
            }
        }

        // --- HELPER FUNCTIONS (INTERACTIONS) ---
        
        // WALLET
        async function handleApprove() {
            const amt = document.getElementById('approve-amount').value;
            if(!amt) return;
            try {
                const tx = await contract.approve(CONTRACT_ADDRESS, ethers.parseEther(amt));
                showToast("Envoi d'approbation...");
                await tx.wait();
                showToast("Approved!");
            } catch(e) { showToast(e.reason || e.message || "Erreur Approbation", "error"); }
        }

        async function handleTransfer() {
            const to = document.getElementById('transfer-to').value;
            const amt = document.getElementById('transfer-amount').value;
            if(!to || !amt) return showToast("Veuillez remplir tous les champs", "error");
            try {
                const tx = await contract.transfer(to, ethers.parseEther(amt));
                showToast("Transfert...");
                await tx.wait();
                showToast("Transfert Effectué");
                refreshData();
            } catch(e) { showToast(e.reason || e.message || "Erreur Transfert", "error"); }
        }

        // IGNITION
        async function handleRegisterAirdrop() {
            try {
                const tx = await contract.registerForIgnitionAirdrop();
                showToast("Inscription en cours...");
                await tx.wait();
                showToast("Inscription Réussie!");
                refreshData();
            } catch(e) { showToast(e.reason || "Erreur Inscription", "error"); }
        }

        async function handleClaimAirdrop() {
            try {
                const tx = await contract.claimIgnitionAirdrop();
                showToast("Réclamation en cours...");
                await tx.wait();
                showToast("Réclamation Réussie!");
                refreshData();
            } catch(e) { showToast(e.reason || "Réclamation", "error"); }
        }

        // BURN
        async function handleBurn() {
            const amt = document.getElementById('burn-amount').value;
            if(!amt) return showToast("Montant requis", "error");
            try {
                const tx = await contract.participateInBurn(ethers.parseEther(amt));
                showToast("Burn en cours...");
                await tx.wait();
                showToast("Brûlure Terminée");
                refreshData();
            } catch(e) { showToast(e.reason || "Échec si le Burn est activé", "error"); }
        }

        async function handleClaimBL2P() {
            try {
                const tx = await contract.claimBL2PReward();
                showToast("Réclamation en cours...");
                await tx.wait();
                showToast("BL2P Réclamé !");
                refreshData();
            } catch(e) { showToast(e.reason || "Echec si le Burn est terminé", "error"); }
        }

        // STAKING
        async function handleStake() {
            const amt = document.getElementById('stake-amount').value;
            if(!amt) return showToast("Montant requis", "error");
            try {
                const tx = await contract.stake(ethers.parseEther(amt));
                showToast("Stakage...");
                await tx.wait();
                showToast("Staké avec succès !");
                refreshData();
            } catch(e) { showToast(e.reason || "Echec le minimum de staking", "error"); }
        }

        async function handleBoost() {
            const amt = document.getElementById('boost-amount').value;
            if(!amt) return;
            try {
                const tx = await contract.useBL2PForStaking(ethers.parseEther(amt));
                showToast("Boost en cours...");
                await tx.wait();
                showToast("Boosté !");
                refreshData();
            } catch(e) { showToast(e.reason || "Erreur de Boost", "error"); }
        }

        async function handleUnstake() {
            try {
                const tx = await contract.unstake();
                showToast("Unstaking...");
                await tx.wait();
                showToast("Unstaké");
                refreshData();
            } catch(e) { showToast(e.reason || "Erreur Unstaking", "error"); }
        }

        // GOVERNANCE
        async function handleSubmitProposal() {
            const type = document.getElementById('proposal-type').value;
            const desc = document.getElementById('proposal-desc').value;
            const val = document.getElementById('proposal-value').value;
            const addr = document.getElementById('proposal-address').value;
            
            if(!desc && (type=='2' && !addr)) return showError("La description est requise", "error");
            // Note: "BurnAmount" et "RewardRate" nécessitent une valeur > 0. "Advertisement" nécessite une description. "UnlockReserve" nécessite une adresse.

            try {
                const tx = await contract.submitProposal(desc, val ? ethers.parseEther(val) : 0, addr, type);
                showToast("Envoi de la proposition...");
                await tx.wait();
                showToast("Proposition Soumise !");
            } catch(e) { showError("Erreur Soumission"); }

        }

        async function loadProposal() {
            const id = document.getElementById('vote-proposal-id').value;
            if(!id) return showError("ID requis");
            try {
                const p = await contract.proposals(id);
                if(p.id == 0n) return showError("Proposition non trouvée");
                
                document.getElementById('proposal-data').style.display = 'block';
                document.getElementById('p-desc').innerText = p.description;
                document.getElementById('p-type').innerText = ["Burn", "Reward", "Pause", "Unlock", "News", "Maturity", "Quorum", "Threshold", "Threshold", "Ads", "Pool", "Lifespan", "Rate", "%Delegé", "Quorum", "Threshold", "%Delegé"];}[p.proposalType];
                document.getElementById('p-for').innerText = ethers.formatEther(p.forVotes);
                document.getElementById('p-against').innerText = ethers.formatEther(p.againstVotes);
            } catch(e) { showError("Erreur Chargement proposition", "error"); }
        }

        async function processCommitVote(support) {
            const id = document.getElementById('vote-proposal-id').value;
            const secret = document.getElementById('commit-secret').value;
            if(!id || !secret) return showError("ID ou Secret requis");
            
            const secretBytes = ethers.toUtf8Bytes(secret);
            const hash = ethers.solidityPackedKeccak256(["bool", "bytes", "address"], [support, secretBytes, userAddress]);
            
            contract.commitVote(id, hash).then(tx => { showToast("Commit..."); return tx.wait(); })
            .then(() => { showToast("Committed !"); })
            .catch(e => showToast(e.reason, "error"));
        }

        function processRevealVote(support) {
            const id = document.getElementById('vote-proposal-id').value;
            const secret = document.getElementById('reveal-secret').value;
            if(!id || !secret) return alertError("ID ou Secret manquant");
            
            const secretBytes = ethers.toUtf8Bytes(secret);
            contract.revealVote(id, support, secretBytes).then(tx => { showToast("Reveal..."); return tx.wait(); })
            .then(() => { showToast("Révélé !"); loadProposal(); }) // Refresh vote counts
            .catch(e) { showToast("Révéale échouée : " + (e.reason || "Erreur Inconnue"), "error"); }
        }

        function handleDelegate() {
            const to = document.getElementById('delegate-to').value;
            const amt = document.getElementById('delegate-amount').value;
            if(!to || !amt) return showError("Remplissez les champs");
            try {
                const tx = await contract.delegateVote(to, ethers.parseEther(amt));
                showToast("Délégation en cours...");
                await tx.wait();
                showToast("Délégué !");
                refreshData();
            } catch(e) { showToast(e.reason, "error"); }
        }

        function handleRevokeDelegate() {
            try {
                const tx = contract.revokeDelegation();
                showToast("Révocation...");
                await tx.wait();
                showToast("Révoqué !");
                refreshData();
            } catch(e) { showToast(e.reason, "error"); }
        }

        // --- ADS (NOUVELLEAUJOUR -->
        async function loadAds() {
            const btn = document.getElementById('more-news');
            btn.innerText = "CHARGER LA LISTE...";
            try {
                if(!contract) return;
                
                const count = await contract.advertisementCount(); // Appel de la fonction `postAdvertisementCount` ajoutée dans l'ABI
                const limit = 10; // Afficher les 10 plus récents à la fois
                const newCount = Number(count);
                
                const list = document.getElementById('news-list');
                
                // Nettoyer toute la liste
                for (let i = newCount; i > 0; i--) {
                    const p = await contract.advertisements(i); // Appel de la fonction `advertisements(id)` ajoutée dans l'ABI
                    
                    if (p.id == 0n) continue; // Arrête si ID est zéro
                    
                    const item = document.createElement('div');
                    item.className = "news-item";
                    
                    // Calcul du temps en date lisible
                    const time = Number(p.postedBlock);
                    const date = new Date(time * 1000).toLocaleDateString(); // Conversion du timestamp en date lisible
                    
                    item.innerHTML = `
                        <div class="news-date">${date}</div>
                        <div class="news-msg">${p.message}</div>
                    `;
                    
                    // Ajouter au début de la liste pour avoir les plus récents en haut
                    list.prepend(item);
                }
                
                if (newCount > newCount) {
                    btn.innerText = "DONE";
                } else if (newCount == newCount) {
                    btn.innerText = "Plus";
                }

            } catch(e) {
                console.error("Erreur chargement Ads:", e);
                showToast("Erreur lors du chargement des pubs", "error");
                btn.innerText = "Error";
            }
        }

        // --- HELPER FONCTIONS ---
        function switchTab(id) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            event.target.classList.add('active');
            
            // Scroll to top automatically on tab switch
            document.querySelector('main').scrollTop = 0;
        }

        // --- UTILS ---
        function alertError(msg) {
            console.error(msg);
            showToast(msg, "error");
            alert("ERREURUR: " + msg);
        }

        // --- THREE.JS BACKGROUND ---
        function initThreeJS() {
            const container = document.getElementById('canvas-container');
            const scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x030303, 0.0015);

            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 10; camera.position.y = 3; camera.rotation.x = -0.3;

            const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            container.appendChild(renderer.domElement);

            const geometry = new THREE.PlaneGeometry(80, 80, 50, 50);
            const material = new THREE.ShaderMaterial({
                uniforms: { u_time: { value: 0 }, u_color: { value: new THREE.Color(0x00ff88) } },
                wireframe: true,
                vertexShader: `
                    uniform float u_time;
                    varying float vElev;
                    void main() {
                        vec4 p = modelMatrix * vec4(position, 1.0);
                        float d = distance(p.xz, vec2(0, 0));
                        float e = sin(d * 0.2 - u_time * 0.5) * 1.0;
                        e += sin(p.x * 0.5 + u_time * 0.3) * 0.5;
                        p.z += e; vElev = e;
                        gl_Position = projectionMatrix * viewMatrix * p;
                        gl_Position.z += e; }
                    }
                `,
                fragmentShader: `
                    uniform vec3 u_color;
                    varying float vElev;
                    void main() {
                        float alpha = (vElev + 1.0) * 0.15;
                        gl_FragColor.a *= (vElev + 1.0); // Boost visibility near top
                        gl_FragColor.a -= (vElev + 1.0); // Fade out towards bottom
                        gl_FragColor.a = mix(u_color, (vElev + 1.0), vElev + 1.0), vElev + 0.5); // Ensure visibility
                        
                        gl_Position.z += e;
                        gl_Position.y += e;
                        gl_Position.y -= e;
                    }
                `
            });

            const plane = new THREE.Mesh(geometry, material);
            scene.add(plane);

            const animate = () => {
                requestAnimationFrame(animate);
                material.uniforms.u_time.value += 0.005;
                renderer.render(scene, camera);
            };
            animate();

            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
        }
        initThreeJS();

        // Load Ads on load
        document.addEventListener('loadAds', () => {
            // On lance le chargement des pubs
        });

    </script>
</body>
</html>
